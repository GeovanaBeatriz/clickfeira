<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Configurações</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,300;0,400;0,500;0,700;1,300;1,400&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="../styles/menu.css" />
  <link rel="stylesheet" href="../styles/configuracoes.css" />
</head>
<body>
  <div id="menu-container"></div>

  <main class="container py-5 d-flex flex-column align-items-center">
    <!-- Formulário Informações Pessoais -->
    <form class="needs-validation w-100" style="max-width: 900px;" novalidate>
      <header class="mb-4">
        <h2>
          <b>Configurações</b> <span class="cinza">/ Usuário</span>
        </h2>
      </header>

      <section class="bg-light p-4 rounded shadow-sm mb-5 w-100">
        <h4 class="mb-4 fw-semibold">Informações pessoais</h4>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="cpf" class="form-label">CPF/CNPJ</label>
            <input
              type="text"
              class="form-control form-control-lg"
              id="cpf"
              name="cpf"
              placeholder="000.000.000-00"
              readonly
            />
          </div>
          <div class="col-md-6 mb-3">
            <label for="nome" class="form-label">Nome completo</label>
            <input
              type="text"
              class="form-control form-control-lg"
              id="nome"
              name="nome"
              placeholder="Seu nome completo"
              required
            />
            <div class="invalid-feedback">Informe seu nome completo.</div>
          </div>
        </div>

        <div class="mb-3">
          <label for="email" class="form-label">E-mail</label>
          <input
            type="email"
            class="form-control form-control-lg"
            id="email"
            name="email"
            placeholder="exemplo@dominio.com"
            required
          />
          <div class="invalid-feedback">Digite um e-mail válido.</div>
        </div>

        <div class="mb-3">
          <label for="telefone" class="form-label">Telefone</label>
          <input
            type="tel"
            class="form-control form-control-lg"
            id="telefone"
            name="telefone"
            placeholder="(00) 00000-0000"
            required
          />
          <div class="invalid-feedback">Informe um telefone de contato.</div>
        </div>

        <div class="mb-3">
          <label for="endereco" class="form-label">Endereço</label>
          <input
            type="text"
            class="form-control form-control-lg"
            id="endereco"
            name="endereco"
            placeholder="Rua, nº, Bairro, Cidade"
            required
          />
          <div class="invalid-feedback">Endereço é obrigatório.</div>
        </div>

        <div class="d-flex justify-content-end gap-3">
          <button type="button" class="btn btn-outline-secondary btn-md">
            Cancelar
          </button>
          <button type="submit" class="btn btn-success btn-md">Salvar</button>
        </div>
      </section>
    </form>

    <!-- Formulário Mudar Senha -->
    <form class="needs-validation w-100" style="max-width: 900px;" novalidate>
      <section class="bg-light p-4 rounded shadow-sm mb-5 w-100">
        <h4 class="mb-4 fw-semibold">Mudar senha</h4>

        <div class="mb-3">
          <label for="senha_atual" class="form-label">Senha Atual</label>
          <input
            type="password"
            class="form-control form-control-lg"
            id="senha_atual"
            name="senha_atual"
            placeholder="Digite sua senha atual"
            required
          />
          <div class="invalid-feedback">Informe a senha atual.</div>
        </div>

        <div class="mb-3">
          <label for="nova_senha" class="form-label">Nova senha</label>
          <input
            type="password"
            class="form-control form-control-lg"
            id="nova_senha"
            name="nova_senha"
            placeholder="Nova senha"
            required
            minlength="6"
          />
          <div class="invalid-feedback">
            A nova senha deve ter pelo menos 6 caracteres.
          </div>
        </div>

        <div class="mb-3">
          <label for="confirmar_senha" class="form-label"
            >Confirmar nova senha</label
          >
          <input
            type="password"
            class="form-control form-control-lg"
            id="confirmar_senha"
            name="confirmar_senha"
            placeholder="Confirme a nova senha"
            required
          />
          <div class="invalid-feedback">Confirme sua nova senha.</div>
        </div>

        <div class="d-flex justify-content-end gap-3">
          <button type="button" class="btn btn-outline-secondary btn-md">
            Cancelar
          </button>
          <button
            type="submit"
            class="btn btn-success btn-md"
            id="btn-mudar-senha"
          >
            Confirmar
          </button>
        </div>
      </section>
    </form>

    <!-- Exclusão de Usuário -->
    <section class="bg-light p-4 rounded shadow-sm mb-5 w-100" style="max-width: 900px;">
      <h4 class="mb-4 fw-semibold">Excluir Usuário</h4>

      <div class="mb-3">
        <p>
          A funcionalidade de exclusão de conta permite que você remova seu
          próprio acesso ao sistema ClickFeira de forma definitiva. Essa ação é
          indicada caso você não deseje mais utilizar a plataforma.
        </p>
        <p>
          Antes de continuar, certifique-se de que não possui pendências ou dados
          importantes vinculados à sua conta. A exclusão é permanente e
          irreversível, e todas as suas permissões de acesso serão removidas.
        </p>
      </div>

      <div class="d-flex justify-content-end gap-3">
        <button type="button" class="btn btn-outline-secondary btn-md">
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-danger btn-md"
          data-bs-toggle="modal"
          data-bs-target="#modalExcluirConta"
        >
          Excluir
        </button>
      </div>

      <!-- Modal -->
      <div
        class="modal fade"
        id="modalExcluirConta"
        tabindex="-1"
        aria-labelledby="modalExcluirLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalExcluirLabel">
                ⚠️ Deseja realmente excluir sua conta?
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Fechar"
              ></button>
            </div>
            <div class="modal-body">
              Ao confirmar, sua conta será permanentemente removida do sistema ClickFeira. 
              Você perderá o acesso imediato à plataforma e esta ação <b>não poderá ser desfeita.</b>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline-secondary"
                data-bs-dismiss="modal"
              >
                Cancelar
              </button>
              <button
                type="button"
                id="btn-confirmar-exclusao"
                class="btn btn-danger"
              >
                Confirmar exclusão
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    (function () {
      "use strict";

      const forms = document.querySelectorAll(".needs-validation");

      Array.from(forms).forEach(function (form) {
        form.addEventListener(
          "submit",
          function (event) {
            if (!form.checkValidity()) {
              event.preventDefault();
              event.stopPropagation();
            }
            form.classList.add("was-validated");
          },
          false
        );
      });
    })();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      fetch("../components/menu.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("menu-container").innerHTML = html;
        })
        .catch((err) => console.error("Erro ao carregar menu:", err));

      const comercianteId = localStorage.getItem("idComerciante");

      if (comercianteId) {
        fetch(`/users/${comercianteId}`)
          .then((response) => response.json())
          .then((data) => {
            if (data) {
              document.getElementById("cpf").value = data.cpf || "";
              document.getElementById("nome").value = data.nome || "";
              document.getElementById("email").value = data.email || "";
              document.getElementById("telefone").value = data.telefone || "";
              document.getElementById("endereco").value = data.endereco || "";
            }
          })
          .catch((error) =>
            console.error("Erro ao carregar dados do usuário:", error)
          );
      } else {
        console.warn("ID do comerciante não encontrado.");
      }
    });
  </script>
</body>
</html>
